<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ” ç§»åŠ¨ç«¯ç™»å½•è¯Šæ–­å·¥å…·</title>
    <script src="/config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin: auto;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        .status-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #28a745;
        }
        
        .status-card.error {
            border-left-color: #dc3545;
            background: #fff5f5;
        }
        
        .status-card.warning {
            border-left-color: #ffc107;
            background: #fffbf0;
        }
        
        .status-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .status-content {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .test-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-bottom: 10px;
        }
        
        .test-button:active {
            transform: scale(0.98);
        }
        
        .test-button.secondary {
            background: #6c757d;
        }
        
        .test-button.success {
            background: #28a745;
        }
        
        .test-button.danger {
            background: #dc3545;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .result.success {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        
        .result.error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }
        
        .result.info {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #2196f3;
        }
        
        .network-info {
            background: #e8f4f8;
            border: 1px solid #17a2b8;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .network-info h3 {
            color: #138496;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .info-item {
            margin-bottom: 5px;
            color: #555;
            font-size: 14px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        .ip-address {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-weight: bold;
        }
        
        .troubleshooting {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid #dee2e6;
        }
        
        .troubleshooting h4 {
            color: #495057;
            margin-bottom: 10px;
        }
        
        .troubleshooting ul {
            margin-left: 20px;
            color: #6c757d;
            font-size: 13px;
        }
        
        .troubleshooting li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ç§»åŠ¨ç«¯ç™»å½•è¯Šæ–­å·¥å…·</h1>
        
        <div class="network-info">
            <h3>ğŸ“± ç½‘ç»œä¿¡æ¯</h3>
            <div id="networkInfo">
                <div class="loading"></div>
            </div>
        </div>
        
        <div class="status-card">
            <div class="status-title">ğŸ¯ è¯Šæ–­æ­¥éª¤</div>
            <div class="status-content">
                æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤é€ä¸€æ’æŸ¥é—®é¢˜ï¼Œç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•
            </div>
        </div>
        
        <button class="test-button" onclick="step1_checkNetwork()">æ­¥éª¤1: æ£€æŸ¥ç½‘ç»œè¿æ¥</button>
        <button class="test-button secondary" onclick="step2_checkCORS()">æ­¥éª¤2: æ£€æŸ¥è·¨åŸŸé…ç½®</button>
        <button class="test-button success" onclick="step3_testLogin()">æ­¥éª¤3: æµ‹è¯•ç™»å½•åŠŸèƒ½</button>
        <button class="test-button danger" onclick="step4_fullDiagnostic()">æ­¥éª¤4: å®Œæ•´è¯Šæ–­</button>
        
        <div id="result" class="result hidden"></div>
        
        <div class="troubleshooting">
            <h4>ğŸ’¡ å¸¸è§é—®é¢˜æ’æŸ¥</h4>
            <ul>
                <li>ç¡®ä¿æ‰‹æœºå’Œç”µè„‘åœ¨åŒä¸€WiFiç½‘ç»œä¸‹</li>
                <li>æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å…è®¸8000ç«¯å£è®¿é—®</li>
                <li>ç¡®è®¤åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ (python app.py)</li>
                <li>å°è¯•å…³é—­æ‰‹æœºVPNæˆ–ä»£ç†è®¾ç½®</li>
                <li>æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰JavaScripté”™è¯¯</li>
            </ul>
        </div>
    </div>

    <script>
        // ç­‰å¾…AppConfigåŠ è½½å®Œæˆ
        async function waitForAppConfig() {
            if (window.AppConfig && window.AppConfig.api && window.AppConfig.api.baseUrl) {
                return window.AppConfig;
            }
            return new Promise(resolve => {
                const checkInterval = setInterval(() => {
                    if (window.AppConfig && window.AppConfig.api && window.AppConfig.api.baseUrl) {
                        clearInterval(checkInterval);
                        resolve(window.AppConfig);
                    }
                }, 100);
            });
        }

        // è·å–APIåœ°å€
        function getApiUrl() {
            // ä½¿ç”¨AppConfigä¸­çš„é…ç½®
            return AppConfig.api.baseUrl;
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = message;
            resultDiv.classList.remove('hidden');
        }

        // è·å–ç½‘ç»œä¿¡æ¯
        function getNetworkInfo() {
            const info = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                screen: `${screen.width}x${screen.height}`,
                window: `${window.innerWidth}x${window.innerHeight}`,
                isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
                isTouchDevice: 'ontouchstart' in window,
                currentUrl: window.location.href,
                apiUrl: getApiUrl(),
                timestamp: new Date().toLocaleString('zh-CN')
            };

            const networkInfoDiv = document.getElementById('networkInfo');
            networkInfoDiv.innerHTML = `
                <div class="info-item"><strong>å½“å‰é¡µé¢:</strong> ${info.currentUrl}</div>
                <div class="info-item"><strong>APIåœ°å€:</strong> ${info.apiUrl}</div>
                <div class="info-item"><strong>ç”¨æˆ·ä»£ç†:</strong> ${info.userAgent}</div>
                <div class="info-item"><strong>å¹³å°:</strong> ${info.platform}</div>
                <div class="info-item"><strong>å±å¹•åˆ†è¾¨ç‡:</strong> ${info.screen}</div>
                <div class="info-item"><strong>çª—å£å¤§å°:</strong> ${info.window}</div>
                <div class="info-item"><strong>ç§»åŠ¨è®¾å¤‡:</strong> ${info.isMobile ? 'âœ… æ˜¯' : 'âŒ å¦'}</div>
                <div class="info-item"><strong>è§¦æ‘¸è®¾å¤‡:</strong> ${info.isTouchDevice ? 'âœ… æ˜¯' : 'âŒ å¦'}</div>
                <div class="info-item"><strong>æ—¶é—´:</strong> ${info.timestamp}</div>
            `;

            return info;
        }

        // æ­¥éª¤1: æ£€æŸ¥ç½‘ç»œè¿æ¥
        async function step1_checkNetwork() {
            showResult('æ­£åœ¨æ£€æŸ¥ç½‘ç»œè¿æ¥... <div class="loading"></div>', 'info');
            
            const apiUrl = getApiUrl();
            const healthUrl = `${apiUrl}/health`;
            
            try {
                const startTime = Date.now();
                const response = await fetch(healthUrl);
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                const data = await response.json();
                
                if (response.ok) {
                    const successMessage = `
                        âœ… <strong>ç½‘ç»œè¿æ¥æ­£å¸¸ï¼</strong><br><br>
                        <strong>è¿æ¥è¯¦æƒ…:</strong><br>
                        å“åº”æ—¶é—´: ${responseTime}ms<br>
                        æœåŠ¡çŠ¶æ€: ${data.status}<br>
                        æ•°æ®åº“çŠ¶æ€: ${data.database}<br>
                        æ—¶é—´æˆ³: ${data.timestamp}<br><br>
                        <strong>å»ºè®®:</strong><br>
                        ç½‘ç»œè¿æ¥æ­£å¸¸ï¼Œå¦‚æœç™»å½•å¤±è´¥ï¼Œè¯·ç»§ç»­æ­¥éª¤2æ£€æŸ¥è·¨åŸŸé…ç½®
                    `;
                    showResult(successMessage, 'success');
                } else {
                    showResult(`âŒ ç½‘ç»œè¿æ¥å¤±è´¥<br>çŠ¶æ€ç : ${response.status}<br>è¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ`, 'error');
                }
            } catch (error) {
                    const errorMessage = `
                        âŒ <strong>ç½‘ç»œè¿æ¥å¤±è´¥</strong><br><br>
                        <strong>é”™è¯¯ä¿¡æ¯:</strong> ${error.message}<br><br>
                        <strong>æ’æŸ¥å»ºè®®:</strong><br>
                        1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ (python app.py)<br>
                        2. ç¡®è®¤é˜²ç«å¢™å…è®¸8000ç«¯å£è®¿é—®<br>
                        3. æ£€æŸ¥æ‰‹æœºå’Œç”µè„‘æ˜¯å¦åœ¨åŒä¸€WiFiç½‘ç»œä¸‹<br>
                        4. å°è¯•ä½¿ç”¨ä¸åŒçš„IPåœ°å€è®¿é—®<br>
                        5. æ£€æŸ¥AppConfigé…ç½®æ˜¯å¦æ­£ç¡®<br><br>
                        <strong>å½“å‰APIåœ°å€:</strong> ${apiUrl}<br>
                        <strong>æµ‹è¯•åœ°å€:</strong> ${healthUrl}
                    `;
                    showResult(errorMessage, 'error');
                }
        }

        // æ­¥éª¤2: æ£€æŸ¥è·¨åŸŸé…ç½®
        async function step2_checkCORS() {
            showResult('æ­£åœ¨æ£€æŸ¥è·¨åŸŸé…ç½®... <div class="loading"></div>', 'info');
            
            const apiUrl = getApiUrl();
            const testUrl = `${apiUrl}/health`;
            
            try {
                // æµ‹è¯•é¢„æ£€è¯·æ±‚
                const response = await fetch(testUrl, {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': window.location.origin,
                        'Access-Control-Request-Method': 'POST',
                        'Access-Control-Request-Headers': 'content-type'
                    }
                });
                
                const corsHeaders = {
                    'Access-Control-Allow-Origin': response.headers.get('Access-Control-Allow-Origin'),
                    'Access-Control-Allow-Methods': response.headers.get('Access-Control-Allow-Methods'),
                    'Access-Control-Allow-Headers': response.headers.get('Access-Control-Allow-Headers'),
                    'Access-Control-Allow-Credentials': response.headers.get('Access-Control-Allow-Credentials')
                };
                
                let corsResult = '<strong>CORSå“åº”å¤´:</strong><br>';
                for (const [key, value] of Object.entries(corsHeaders)) {
                    corsResult += `${key}: ${value || 'æœªè®¾ç½®'}<br>`;
                }
                
                // æµ‹è¯•å®é™…POSTè¯·æ±‚
                const testResponse = await fetch(`${apiUrl}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Origin': window.location.origin
                    },
                    body: JSON.stringify({ username: 'test', password: 'test' })
                });
                
                const originHeader = testResponse.headers.get('Access-Control-Allow-Origin');
                
                let resultMessage = `
                    âœ… <strong>è·¨åŸŸé…ç½®æ£€æŸ¥å®Œæˆ</strong><br><br>
                    ${corsResult}<br>
                    <strong>å®é™…è¯·æ±‚æµ‹è¯•:</strong><br>
                    çŠ¶æ€ç : ${testResponse.status}<br>
                    Access-Control-Allow-Origin: ${originHeader || 'æœªè®¾ç½®'}<br><br>
                `;
                
                if (originHeader === '*' || originHeader === window.location.origin) {
                    resultMessage += '<strong>âœ… CORSé…ç½®æ­£å¸¸</strong><br>è·¨åŸŸè¯·æ±‚åº”è¯¥å¯ä»¥æ­£å¸¸è¿›è¡Œ';
                    showResult(resultMessage, 'success');
                } else {
                    resultMessage += '<strong>âš ï¸ CORSé…ç½®å¯èƒ½æœ‰é—®é¢˜</strong><br>è¯·æ£€æŸ¥åç«¯CORSé…ç½®';
                    showResult(resultMessage, 'warning');
                }
                
            } catch (error) {
                showResult(`âŒ è·¨åŸŸæ£€æŸ¥å¤±è´¥: ${error.message}<br>è¿™å¯èƒ½è¡¨ç¤ºCORSé…ç½®æœ‰é—®é¢˜`, 'error');
            }
        }

        // æ­¥éª¤3: æµ‹è¯•ç™»å½•åŠŸèƒ½
        async function step3_testLogin() {
            showResult('æ­£åœ¨æµ‹è¯•ç™»å½•åŠŸèƒ½... <div class="loading"></div>', 'info');
            
            const apiUrl = getApiUrl();
            const loginUrl = `${apiUrl}/api/auth/login`;
            
            try {
                // ä½¿ç”¨æµ‹è¯•å‡­æ®è¿›è¡Œç™»å½•
                const response = await fetch(loginUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'User-Agent': navigator.userAgent
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123'
                    })
                });
                
                const responseText = await response.text();
                
                let resultMessage = `
                    <strong>ç™»å½•æµ‹è¯•ç»“æœ:</strong><br>
                    çŠ¶æ€ç : ${response.status}<br>
                    å“åº”å¤´: ${JSON.stringify(Object.fromEntries(response.headers.entries()), null, 2)}<br>
                    å“åº”ä½“: ${responseText}<br><br>
                `;
                
                if (response.ok) {
                    try {
                        const data = JSON.parse(responseText);
                        if (data.access_token) {
                            resultMessage += `
                                âœ… <strong>ç™»å½•æˆåŠŸï¼</strong><br>
                                Token: ${data.access_token.substring(0, 30)}...<br>
                                Tokenç±»å‹: ${data.token_type}<br><br>
                                <strong>å»ºè®®:</strong><br>
                                ç™»å½•åŠŸèƒ½æ­£å¸¸ï¼Œå¦‚æœæ‰‹æœºç«¯ä»ç„¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒIPåœ°å€é…ç½®
                            `;
                            showResult(resultMessage, 'success');
                        } else {
                            resultMessage += 'âŒ ç™»å½•å“åº”ä¸­æ²¡æœ‰æ‰¾åˆ°access_token';
                            showResult(resultMessage, 'error');
                        }
                    } catch (e) {
                        resultMessage += `âŒ å“åº”ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼: ${e.message}`;
                        showResult(resultMessage, 'error');
                    }
                } else {
                    resultMessage += `
                        âŒ <strong>ç™»å½•å¤±è´¥</strong><br>
                        çŠ¶æ€ç : ${response.status}<br>
                        é”™è¯¯ä¿¡æ¯: ${responseText}<br><br>
                        <strong>æ’æŸ¥å»ºè®®:</strong><br>
                        1. æ£€æŸ¥ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡® (admin/admin123)<br>
                        2. ç¡®è®¤åç«¯æ•°æ®åº“è¿æ¥æ­£å¸¸<br>
                        3. æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–è®¤è¯æœºåˆ¶å¹²æ‰°
                    `;
                    showResult(resultMessage, 'error');
                }
                
            } catch (error) {
                        const errorMessage = `
                            âŒ <strong>ç™»å½•æµ‹è¯•å¤±è´¥</strong><br><br>
                            <strong>é”™è¯¯ä¿¡æ¯:</strong> ${error.message}<br><br>
                            <strong>è¯¦ç»†æ’æŸ¥:</strong><br>
                            1. æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸<br>
                            2. ç¡®è®¤åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ<br>
                            3. æ£€æŸ¥CORSé…ç½®æ˜¯å¦æ­£ç¡®<br>
                            4. ç¡®è®¤APIç«¯ç‚¹åœ°å€æ˜¯å¦æ­£ç¡®<br>
                            5. æ£€æŸ¥AppConfigé…ç½®æ˜¯å¦æ­£ç¡®<br><br>
                            <strong>æµ‹è¯•åœ°å€:</strong> ${loginUrl}
                        `;
                        showResult(errorMessage, 'error');
                    }
        }

        // æ­¥éª¤4: å®Œæ•´è¯Šæ–­
        async function step4_fullDiagnostic() {
            showResult('æ­£åœ¨è¿›è¡Œå®Œæ•´è¯Šæ–­... <div class="loading"></div>', 'info');
            
            const results = [];
            const apiUrl = getApiUrl();
            
            // 1. æ£€æŸ¥ç½‘ç»œè¿æ¥
            try {
                const healthResponse = await fetch(`${apiUrl}/health`);
                results.push(`âœ… ç½‘ç»œè¿æ¥: ${healthResponse.ok ? 'æ­£å¸¸' : 'å¤±è´¥'}`);
            } catch (error) {
                results.push(`âŒ ç½‘ç»œè¿æ¥: ${error.message}`);
            }
            
            // 2. æ£€æŸ¥ç™»å½•
            try {
                const loginResponse = await fetch(`${apiUrl}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'admin', password: 'admin123' })
                });
                results.push(`âœ… ç™»å½•åŠŸèƒ½: ${loginResponse.ok ? 'æ­£å¸¸' : 'å¤±è´¥'}`);
                
                if (loginResponse.ok) {
                    const data = await loginResponse.json();
                    const token = data.access_token;
                    
                    // 3. æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯
                    try {
                        const userResponse = await fetch(`${apiUrl}/api/auth/me`, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        results.push(`âœ… ç”¨æˆ·ä¿¡æ¯: ${userResponse.ok ? 'æ­£å¸¸' : 'å¤±è´¥'}`);
                    } catch (error) {
                        results.push(`âŒ ç”¨æˆ·ä¿¡æ¯: ${error.message}`);
                    }
                }
            } catch (error) {
                results.push(`âŒ ç™»å½•åŠŸèƒ½: ${error.message}`);
            }
            
            // 4. æ£€æŸ¥å…¶ä»–ç«¯ç‚¹
            const endpoints = [
                { name: 'è®¾å¤‡åˆ—è¡¨', url: `${apiUrl}/api/devices` },
                { name: 'è¯•å‰‚åˆ—è¡¨', url: `${apiUrl}/api/reagents` }
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint.url);
                    results.push(`âœ… ${endpoint.name}: ${response.ok ? 'æ­£å¸¸' : 'å¤±è´¥'}`);
                } catch (error) {
                    results.push(`âŒ ${endpoint.name}: ${error.message}`);
                }
            }
            
            // 5. æ£€æŸ¥è®¾å¤‡ä¿¡æ¯
            const deviceInfo = getNetworkInfo();
            results.push(`â„¹ï¸ è®¾å¤‡ç±»å‹: ${deviceInfo.isMobile ? 'ç§»åŠ¨è®¾å¤‡' : 'æ¡Œé¢è®¾å¤‡'}`);
            results.push(`â„¹ï¸ ç½‘ç»œè¿æ¥: ${deviceInfo.isTouchDevice ? 'æ”¯æŒè§¦æ‘¸' : 'ä¸æ”¯æŒè§¦æ‘¸'}`);
            
            const finalMessage = `
                <strong>ğŸ” å®Œæ•´è¯Šæ–­ç»“æœ</strong><br><br>
                ${results.join('<br>')}<br><br>
                <strong>æ€»ç»“:</strong><br>
                å¦‚æœç½‘ç»œè¿æ¥å’Œç™»å½•åŠŸèƒ½éƒ½æ˜¾ç¤ºæ­£å¸¸ï¼Œä½†æ‰‹æœºç«¯ä»ç„¶æ— æ³•ç™»å½•ï¼Œ<br>
                é—®é¢˜å¯èƒ½å‡ºåœ¨æ‰‹æœºç½‘ç»œé…ç½®æˆ–IPåœ°å€è®¾ç½®ä¸Šã€‚<br><br>
                <strong>å»ºè®®ä¸‹ä¸€æ­¥:</strong><br>
                1. ç¡®è®¤æ‰‹æœºä½¿ç”¨çš„IPåœ°å€æ˜¯å¦æ­£ç¡®<br>
                2. æ£€æŸ¥æ‰‹æœºå’Œç”µè„‘æ˜¯å¦åœ¨åŒä¸€ç½‘ç»œä¸‹<br>
                3. å°è¯•ä½¿ç”¨æ‰‹æœºæµè§ˆå™¨è®¿é—®æµ‹è¯•é¡µé¢
            `;
            
            showResult(finalMessage, 'info');
        }

        // é¡µé¢åŠ è½½æ—¶è·å–è®¾å¤‡ä¿¡æ¯
        window.addEventListener('load', async () => {
            try {
                await waitForAppConfig();
                getNetworkInfo();
                
                // æ˜¾ç¤ºå½“å‰IPåœ°å€å»ºè®®
                const currentHost = window.location.hostname;
                const apiUrl = getApiUrl();
                
                if (currentHost === 'localhost' || currentHost === '127.0.0.1') {
                    showResult(`
                        âš ï¸ <strong>æ£€æµ‹åˆ°ä½¿ç”¨localhostè®¿é—®</strong><br><br>
                        å½“å‰åœ°å€: ${window.location.href}<br>
                        APIåœ°å€: ${apiUrl}<br><br>
                        <strong>é‡è¦æç¤º:</strong><br>
                        æ‰‹æœºæ— æ³•é€šè¿‡localhostè®¿é—®ä½ çš„ç”µè„‘æœåŠ¡ã€‚<br>
                        è¯·ä½¿ç”¨ç”µè„‘çš„IPåœ°å€è®¿é—®ï¼Œä¾‹å¦‚:<br>
                        <div class="ip-address">http://172.30.81.103:3000/mobile_login_final_test.html</div>
                        <br>
                        <strong>æ‰‹æœºåº”è¯¥ä½¿ç”¨çš„APIåœ°å€:</strong><br>
                        <div class="ip-address">${apiUrl}</div>
                        <br>
                        <strong>AppConfigé…ç½®:</strong><br>
                        APIåŸºç¡€URL: ${AppConfig.api.baseUrl}<br>
                        ç‰ˆæœ¬: ${AppConfig.version || 'æœªæŒ‡å®š'}
                    `, 'warning');
                }
            } catch (error) {
                console.error('AppConfigåŠ è½½å¤±è´¥:', error);
                showResult(`
                    âŒ <strong>AppConfigé…ç½®åŠ è½½å¤±è´¥</strong><br><br>
                    <strong>é”™è¯¯ä¿¡æ¯:</strong> ${error.message}<br><br>
                    <strong>æ’æŸ¥å»ºè®®:</strong><br>
                    1. ç¡®è®¤config.jsæ–‡ä»¶å­˜åœ¨å¹¶å¯è®¿é—®<br>
                    2. æ£€æŸ¥config.jsæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®<br>
                    3. ç¡®ä¿AppConfig.api.baseUrlå·²æ­£ç¡®é…ç½®
                `, 'error');
            }
        });
    </script>
</body>
</html>