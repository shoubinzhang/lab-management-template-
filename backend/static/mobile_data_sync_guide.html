<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§»åŠ¨ç«¯æ•°æ®åŒæ­¥æŒ‡å— - å®éªŒå®¤ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 10px;
            background: #f8f9fa;
            border-left: 4px solid #4facfe;
        }
        
        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .section h3 {
            color: #555;
            margin: 15px 0 10px 0;
            font-size: 1.2em;
        }
        
        .problem-list {
            list-style: none;
            padding: 0;
        }
        
        .problem-list li {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #ff6b6b;
        }
        
        .solution-list {
            list-style: none;
            padding: 0;
        }
        
        .solution-list li {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #51cf66;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffa94d 0%, #ff922b 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #fa5252 100%);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .status-panel {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .status-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }
        
        .status-good {
            border-left: 4px solid #51cf66;
        }
        
        .status-warning {
            border-left: 4px solid #ffa94d;
        }
        
        .status-error {
            border-left: 4px solid #ff6b6b;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“± ç§»åŠ¨ç«¯æ•°æ®åŒæ­¥æŒ‡å—</h1>
            <p>è§£å†³ç§»åŠ¨ç«¯ä¸ç½‘é¡µç«¯æ•°æ®ä¸ä¸€è‡´é—®é¢˜</p>
        </div>
        
        <div class="content">
            <div class="section">
                <h2>ğŸ” é—®é¢˜è¯Šæ–­</h2>
                <p>ç§»åŠ¨ç«¯å’Œç½‘é¡µç«¯æ•°æ®ä¸ä¸€è‡´çš„ä¸»è¦åŸå› ï¼š</p>
                
                <ul class="problem-list">
                    <li><strong>å­˜å‚¨é”®åä¸ç»Ÿä¸€</strong>ï¼šç§»åŠ¨ç«¯å’Œç½‘é¡µç«¯ä½¿ç”¨ä¸åŒçš„localStorageé”®å</li>
                    <li><strong>APIé…ç½®å·®å¼‚</strong>ï¼šç§»åŠ¨ç«¯å’Œç½‘é¡µç«¯å¯èƒ½è¿æ¥åˆ°ä¸åŒçš„APIåœ°å€</li>
                    <li><strong>ç¼“å­˜æœºåˆ¶ä¸åŒ</strong>ï¼šæ•°æ®ç¼“å­˜ç­–ç•¥å’Œæ›´æ–°é¢‘ç‡ä¸ä¸€è‡´</li>
                    <li><strong>ç½‘ç»œç¯å¢ƒå·®å¼‚</strong>ï¼šç§»åŠ¨ç«¯å’Œç½‘é¡µç«¯å¯èƒ½å¤„äºä¸åŒçš„ç½‘ç»œç¯å¢ƒ</li>
                </ul>
                
                <div class="status-panel">
                    <h3>å½“å‰æ•°æ®åŒæ­¥çŠ¶æ€</h3>
                    <div id="syncStatus">
                        <div class="status-item status-warning">æ­£åœ¨æ£€æµ‹æ•°æ®åŒæ­¥çŠ¶æ€...</div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ</h2>
                
                <h3>æ–¹æ¡ˆä¸€ï¼šè‡ªåŠ¨ä¿®å¤ï¼ˆæ¨èï¼‰</h3>
                <ul class="solution-list">
                    <li>ä½¿ç”¨æ•°æ®åŒæ­¥ä¿®å¤å·¥å…·è‡ªåŠ¨ç»Ÿä¸€å­˜å‚¨é”®å</li>
                    <li>è‡ªåŠ¨æ£€æµ‹å¹¶ä¿®å¤APIé…ç½®å·®å¼‚</li>
                    <li>ä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ</li>
                </ul>
                
                <h3>æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨ä¿®å¤</h3>
                <ul class="solution-list">
                    <li>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’ŒlocalStorage</li>
                    <li>é‡æ–°ç™»å½•ç³»ç»Ÿ</li>
                    <li>ç¡®ä¿ä½¿ç”¨ç›¸åŒçš„APIåœ°å€</li>
                </ul>
                
                <h3>æ–¹æ¡ˆä¸‰ï¼šé¢„é˜²æªæ–½</h3>
                <ul class="solution-list">
                    <li>ä½¿ç”¨ç»Ÿä¸€çš„æ•°æ®åŒæ­¥é…ç½®</li>
                    <li>å®šæœŸæ£€æŸ¥æ•°æ®ä¸€è‡´æ€§</li>
                    <li>é¿å…é¢‘ç¹åˆ‡æ¢ç½‘ç»œç¯å¢ƒ</li>
                </ul>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="checkSyncStatus()">æ£€æµ‹åŒæ­¥çŠ¶æ€</button>
                    <button class="btn btn-success" onclick="fixDataSync()">è‡ªåŠ¨ä¿®å¤åŒæ­¥</button>
                    <button class="btn btn-warning" onclick="clearStorage()">æ¸…é™¤ç¼“å­˜</button>
                    <a href="/mobile_login_final" class="btn btn-danger">é‡æ–°ç™»å½•</a>
                </div>
            </div>
            
            <div class="section">
                <h2>ğŸ“‹ æŠ€æœ¯ç»†èŠ‚</h2>
                
                <h3>å­˜å‚¨é”®åæ˜ å°„</h3>
                <div class="code-block">
// ç§»åŠ¨ç«¯å­˜å‚¨é”®å
ç§»åŠ¨ç«¯: token, auth_token, username

// ç½‘é¡µç«¯å­˜å‚¨é”®å  
ç½‘é¡µç«¯: token, authToken, user, userInfo

// ç»Ÿä¸€åçš„å­˜å‚¨é”®å
ç»Ÿä¸€: token, authToken, auth_token, user, username, userInfo
                </div>
                
                <h3>APIé…ç½®ç»Ÿä¸€</h3>
                <div class="code-block">
// ç§»åŠ¨ç«¯APIé…ç½®æ£€æµ‹é€»è¾‘
1. æ£€æŸ¥localStorageä¸­çš„apiBaseUrl
2. æµ‹è¯•å¤šä¸ªå¯èƒ½çš„APIåœ°å€
3. è‡ªåŠ¨é€‰æ‹©å¯ç”¨çš„APIåœ°å€
4. ä¿å­˜é…ç½®åˆ°localStorage

// ç½‘é¡µç«¯APIé…ç½®
1. ä½¿ç”¨ç¯å¢ƒå˜é‡REACT_APP_API_URL
2. å¼€å‘ç¯å¢ƒä¸‹ä½¿ç”¨ä»£ç†é…ç½®
3. ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨å›ºå®šåœ°å€
                </div>
            </div>
            
            <div class="section">
                <h2>ğŸ“ æŠ€æœ¯æ”¯æŒ</h2>
                <p>å¦‚æœä»¥ä¸Šæ–¹æ³•æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒï¼š</p>
                
                <ul class="solution-list">
                    <li><strong>ç³»ç»Ÿç®¡ç†å‘˜</strong>ï¼šæ£€æŸ¥æœåŠ¡å™¨é…ç½®å’ŒAPIæœåŠ¡çŠ¶æ€</li>
                    <li><strong>æŠ€æœ¯æ”¯æŒå›¢é˜Ÿ</strong>ï¼šæä¾›è¯¦ç»†çš„é—®é¢˜æè¿°å’Œé”™è¯¯æ—¥å¿—</li>
                    <li><strong>å¼€å‘å›¢é˜Ÿ</strong>ï¼šæŠ¥å‘Šç³»ç»Ÿbugå’ŒåŠŸèƒ½éœ€æ±‚</li>
                </ul>
                
                <div class="action-buttons">
                    <a href="/mobile_helper" class="btn btn-primary">è®¿é—®åŠ©æ‰‹é¡µé¢</a>
                    <a href="/mobile_login_final" class="btn btn-success">è¿”å›ç™»å½•é¡µé¢</a>
                    <a href="/" class="btn btn-warning">è¿”å›ä¸»é¡µ</a>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // æ£€æµ‹æ•°æ®åŒæ­¥çŠ¶æ€
        function checkSyncStatus() {
            const syncStatus = document.getElementById('syncStatus');
            syncStatus.innerHTML = '<div class="status-item status-warning">æ­£åœ¨æ£€æµ‹æ•°æ®åŒæ­¥çŠ¶æ€...</div>';
            
            // æ£€æŸ¥å­˜å‚¨é”®åä¸€è‡´æ€§
            const mobileKeys = ['token', 'auth_token', 'username'];
            const webKeys = ['token', 'authToken', 'user', 'userInfo'];
            
            let statusHtml = '';
            let allGood = true;
            
            // æ£€æŸ¥ç§»åŠ¨ç«¯é”®å
            mobileKeys.forEach(key => {
                const value = localStorage.getItem(key);
                const status = value ? 'status-good' : 'status-warning';
                const text = value ? 'âœ“ å·²è®¾ç½®' : 'âš  æœªè®¾ç½®';
                if (!value) allGood = false;
                statusHtml += `<div class="status-item ${status}">ç§»åŠ¨ç«¯ ${key}: ${text}</div>`;
            });
            
            // æ£€æŸ¥ç½‘é¡µç«¯é”®å
            webKeys.forEach(key => {
                const value = localStorage.getItem(key);
                const status = value ? 'status-good' : 'status-warning';
                const text = value ? 'âœ“ å·²è®¾ç½®' : 'âš  æœªè®¾ç½®';
                if (!value) allGood = false;
                statusHtml += `<div class="status-item ${status}">ç½‘é¡µç«¯ ${key}: ${text}</div>`;
            });
            
            // æ£€æŸ¥APIé…ç½®
            const apiUrl = localStorage.getItem('apiBaseUrl');
            const apiStatus = apiUrl ? 'status-good' : 'status-warning';
            const apiText = apiUrl ? 'âœ“ å·²é…ç½®' : 'âš  æœªé…ç½®';
            if (!apiUrl) allGood = false;
            statusHtml += `<div class="status-item ${apiStatus}">APIé…ç½®: ${apiText} ${apiUrl || ''}</div>`;
            
            // æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
            const tokenConsistent = localStorage.getItem('token') === localStorage.getItem('authToken');
            const authConsistent = localStorage.getItem('auth_token') === localStorage.getItem('authToken');
            
            const consistencyStatus = tokenConsistent && authConsistent ? 'status-good' : 'status-error';
            const consistencyText = tokenConsistent && authConsistent ? 'âœ“ æ•°æ®ä¸€è‡´' : 'âŒ æ•°æ®ä¸ä¸€è‡´';
            if (!tokenConsistent || !authConsistent) allGood = false;
            statusHtml += `<div class="status-item ${consistencyStatus}">æ•°æ®ä¸€è‡´æ€§: ${consistencyText}</div>`;
            
            // æ€»ä½“çŠ¶æ€
            const overallStatus = allGood ? 'status-good' : 'status-error';
            const overallText = allGood ? 'âœ“ æ•°æ®åŒæ­¥æ­£å¸¸' : 'âŒ éœ€è¦æ•°æ®åŒæ­¥ä¿®å¤';
            statusHtml += `<div class="status-item ${overallStatus}"><strong>æ€»ä½“çŠ¶æ€: ${overallText}</strong></div>`;
            
            syncStatus.innerHTML = statusHtml;
        }
        
        // ä¿®å¤æ•°æ®åŒæ­¥
        function fixDataSync() {
            const syncStatus = document.getElementById('syncStatus');
            syncStatus.innerHTML = '<div class="status-item status-warning">æ­£åœ¨ä¿®å¤æ•°æ®åŒæ­¥...</div>';
            
            // è·å–å½“å‰æœ‰æ•ˆçš„tokenå’Œç”¨æˆ·ä¿¡æ¯
            const token = localStorage.getItem('token') || localStorage.getItem('authToken') || localStorage.getItem('auth_token');
            const username = localStorage.getItem('username') || (localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user')).username : null);
            
            if (!token || !username) {
                syncStatus.innerHTML = '<div class="status-item status-error">âŒ æœªæ‰¾åˆ°æœ‰æ•ˆçš„ç™»å½•ä¿¡æ¯ï¼Œè¯·é‡æ–°ç™»å½•</div>';
                return;
            }
            
            // ç»Ÿä¸€å­˜å‚¨é”®å
            localStorage.setItem('token', token);
            localStorage.setItem('authToken', token);
            localStorage.setItem('auth_token', token);
            
            localStorage.setItem('user', username);
            localStorage.setItem('username', username);
            localStorage.setItem('userInfo', JSON.stringify({
                username: username,
                access_token: token
            }));
            
            // ä¿å­˜APIé…ç½®
            const apiUrl = localStorage.getItem('apiBaseUrl') || window.location.origin.replace(/:[0-9]+$/, ':8000');
            localStorage.setItem('apiBaseUrl', apiUrl);
            
            setTimeout(() => {
                checkSyncStatus();
                syncStatus.innerHTML += '<div class="status-item status-good">âœ“ æ•°æ®åŒæ­¥ä¿®å¤å®Œæˆï¼</div>';
            }, 1000);
        }
        
        // æ¸…é™¤ç¼“å­˜
        function clearStorage() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç¼“å­˜æ•°æ®å—ï¼Ÿè¿™å°†éœ€è¦é‡æ–°ç™»å½•ã€‚')) {
                localStorage.clear();
                checkSyncStatus();
                alert('ç¼“å­˜å·²æ¸…é™¤ï¼Œè¯·é‡æ–°ç™»å½•ç³»ç»Ÿã€‚');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æµ‹
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkSyncStatus, 500);
        });
    </script>
</body>
</html>